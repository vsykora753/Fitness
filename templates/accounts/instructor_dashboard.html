{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="login-wrapper">
  <div class="login-container dashboard-container">
    <div class="login-header">
      <h2>Lektor – přehled</h2>
      <p>Vítejte, {{ request.user.get_full_name|default:request.user.username }}. Zde najdete své lekce a čekající platby.</p>
    </div>

    <div class="lesson-card" style="margin-bottom: 20px;">
      <div class="lesson-title">Moje lekce</div>
      {% with lessons=request.user.instructor_lessons.all %}
        {% if lessons %}
          <ul style="margin-top: 10px;">
            {% for l in lessons|slice:':5' %}
              <li style="margin:6px 0;">{{ l.title }} – {{ l.date|date:'d.m.Y' }} {{ l.start_time }}</li>
            {% endfor %}
          </ul>
          {% if lessons.count > 5 %}
            <p style="margin-top:8px; color:#666; font-size:0.9em;">... a dalších {{ lessons.count|add:"-5" }} lekcí</p>
          {% endif %}
        {% else %}
          <p style="margin-top:10px; color:#666;">Zatím nemáte vytvořené žádné lekce.</p>
        {% endif %}
      {% endwith %}
      <div style="margin-top:12px;">
        <a class="btn" href="{% url 'bookings:instructor_lessons' %}">
          <i class="fas fa-list"></i> Správa lekcí
        </a>
        <a class="btn" style="margin-left:8px; background-color:#28a745; border-color:#28a745;" href="{% url 'bookings:lesson_create' %}">
          <i class="fas fa-plus"></i> Nová lekce
        </a>
      </div>
    </div>

    <div class="lesson-card">
      <div class="lesson-title">Čekající platby ke schválení</div>
      {% if pending_payments %}
        <ul style="margin-top: 10px;">
          {% for p in pending_payments %}
            <li style="margin:6px 0;">
              {{ p.client.get_full_name|default:p.client.username }} – {{ p.amount }} Kč, {{ p.created_at|date:'d.m.Y H:i' }}
              <a class="btn" style="margin-left:8px; padding:6px 10px;" href="{% url 'payment_confirm' p.id %}">Potvrdit</a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p style="margin-top:10px; color:#666;">Žádné čekající platby.</p>
      {% endif %}
      <div style="margin-top:12px;"><a class="btn" href="{% url 'payment_history' %}">Historie plateb</a></div>
    </div>

    <div class="lesson-card" style="margin-top: 20px;">
      <div class="lesson-title">Čekající dobití kreditu</div>
      {% with topups=pending_topups %}
        {% if topups %}
          <ul style="margin-top: 10px;">
            {% for t in topups|slice:':10' %}
              <li style="margin:6px 0;">
                {{ t.user.get_full_name|default:t.user.username }} – {{ t.amount }} Kč, VS {{ t.variable_symbol }}
                <a class="btn" style="margin-left:8px; padding:6px 10px;" href="{% url 'topup_approve' t.id %}">Potvrdit</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p style="margin-top:10px; color:#666;">Žádná čekající dobití.</p>
        {% endif %}
      {% endwith %}
      <div style="margin-top:12px;"><a class="btn" href="{% url 'topup_approve_list' %}">Zobrazit vše</a></div>
    </div>
  </div>
</div>
{% endblock %}
